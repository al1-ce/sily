#!/usr/bin/env dub
/+ dub.sdl:
name "coniotest"
dependency "sily" path="/g/sily-dlang/"
dependency "sily:logger" path="/g/sily-dlang/"
+/

import std.stdio: writef;

import sily.terminal;
import sily.logger;
import sily.bashfmt;
import sily.vector;
import sily.color;

void main() {

    writef("Preparing alternative buffer\n");
    sleep(500);
    eraseLines(2);
    writef("Preparing alternative buffer.\n");
    sleep(500);
    eraseLines(2);
    writef("Preparing alternative buffer..\n");
    sleep(500);
    eraseLines(2);
    writef("Preparing alternative buffer...\n");
    sleep(500);
    log("Terminal mode set to raw");
    sleep(500);
    // info(getCursorPosition().toString);

    int key;
    setTitle("Test app cool");
    screenEnableAltBuffer();
    writef("Press key: ");
    terminalModeSetRaw();

    bool quit = false;
    int i = 0;
    while (!quit) {
        while (kbhit()) {
            ++i;
            key = getch();

            if (key == 17) { // C-q
                quit = true;
                writef("\r\n");
                warning("Quitting");
                writef("\r");
                break;
            // } else {
            } else if (key >= 20) {
                // writef(" %d ", key);
                writef("| %c ", cast(char) key);
            } else {
                writef("| %d ", key);
            }
        }
        if (i != 0 && !quit) writef(" %d ", i);
        i = 0;
    }

    terminalModeReset();
    screenDisableAltBuffer();
    log("Reset terminal mode");
}
